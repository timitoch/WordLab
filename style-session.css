/* Session / Flashcard View */
.view-section.session-redesign {
    display: flex;
    flex-direction: column;
    flex: 1;
    position: relative;
    /* Base for absolute overlays */
}

/* 1. Top Bar */
.session-top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.session-actions {
    display: flex;
    gap: 0.75rem;
}

.btn-square {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-muted);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-square:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-main);
}

.btn-square.active-toggle {
    border-color: var(--primary);
    color: var(--primary);
    background: rgba(99, 102, 241, 0.1);
}

.session-mastered-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-muted);
}

/* 2. Stats Row */
.session-stats-row {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    width: 100%;
}

.stat-card-mini {
    flex: 1;
    /* Stretch to fill space */
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 0.75rem 0.5rem;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-width: 0;
    /* Prevents overflow */
}

.stat-card-mini .val {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-main);
    margin-bottom: 0.2rem;
}

.stat-card-mini .lbl {
    font-size: 0.7rem;
    color: var(--text-muted);
    line-height: 1.1;
}

/* 3. Flashcard (Flip Animation) */
.flashcard-container {
    flex: 1;
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;
    perspective: 1500px;
}

.flashcard {
    position: relative;
    width: 100%;
    min-height: 280px;
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
    cursor: pointer;
    border-radius: 24px;
    /* remove generic card bg, faces handle it */
}

/* Flip State */
.flashcard.is-flipped {
    transform: rotateY(180deg);
}

.btn-card-edit {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.4);
    cursor: pointer;
    padding: 0.5rem;
    transition: color 0.2s, opacity 0.2s;
    z-index: 10;
}

.btn-card-edit:hover {
    color: rgba(255, 255, 255, 1);
}

.card-face {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    /* For Safari/Chrome */
    background: rgba(15, 23, 42, 0.4);
    /* Darker semi-transparent base for better contrast */
    backdrop-filter: blur(20px);
    /* Stronger blur for glass effect */
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    padding: 2rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
    overflow: hidden;
    /* Prevent scrolling as requested */
}

/* 
   To prevent prosvet (see-through) in the middle of transparency-based flip:
   - Total flip is 0.6s.
   - 90 degrees is at 0.3s.
   - We switch visibility INSTANTLY exactly at 0.3s.
*/

.card-front,
.card-back {
    /* Base transition for the "switch" effect */
    transition: opacity 0s linear 0.3s, visibility 0s linear 0.3s;
}

/* Default state: Front is visible, Back is hidden */
.card-front {
    z-index: 2;
    opacity: 1;
    visibility: visible;
    transform: translateZ(1px);
    /* Separation */
}

.card-back {
    z-index: 1;
    opacity: 0;
    visibility: hidden;
    transform: rotateY(180deg) translateZ(1px);
    /* Separation */
}

/* Flipped state: Front is hidden, Back is visible */
.flashcard.is-flipped .card-front {
    opacity: 0;
    visibility: hidden;
}

.flashcard.is-flipped .card-back {
    opacity: 1;
    visibility: visible;
}

.card-face h1 {
    font-size: 1.8rem;
    /* Further reduced size */
    margin-bottom: 0.5rem;
    color: #ffffff;
    /* White color instead of pink gradient */
    word-break: break-word;
    /* Ensure long words don't overflow horizontally */
    line-height: 1.2;
    padding: 0 1rem;
}

.sub-text {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    font-style: italic;
}

.examples {
    margin-top: 0.5rem;
    /* Reduced gap */
    width: 100%;
    text-align: left;
}

.examples p {
    background: rgba(255, 255, 255, 0.03);
    padding: 0.75rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-muted);
    border-left: 3px solid var(--primary);
}

.highlight {
    color: var(--text-main);
    font-weight: 700;
    font-style: italic;
}

.tap-hint {
    position: absolute;
    bottom: 1rem;
    width: 100%;
    color: var(--text-muted);
    font-size: 0.8rem;
    opacity: 0.6;
}

/* 4. Controls (Grid 2 cols) */
.session-controls {
    width: 100%;
    margin-bottom: 1rem;
}

.rating-grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
}

.btn-rate {
    border-radius: 12px;
    padding: 0.5rem;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 60px;
    font-size: 0.95rem;
    transition: all 0.2s;
}

.btn-rate span {
    font-size: 0.75rem;
    font-weight: 400;
    opacity: 0.9;
    margin-top: 0.2rem;
}

.btn-rate:active {
    transform: scale(0.98);
}

/* Specific Colors from Mockup (Light w/ Border) */
/* 1: Blue-ish/Grey, 2: Blue-ish */
/* Actually Screenshot: 
   1 (He помню): Light Blue BG, Dark Blue Text.
   2 (С трудом): Light Blue BG, Dark Blue Text.
   3 (Частично): Light Teal BG, Teal Text.
   4 (Почти): Light Green BG, Green Text.
   5 (Помню): Light Green BG, Dark Green Text.
   6 (Отлично): Light Lime/Yellow BG, Dark Text.
*/

/* Helper to generate opaque styles for buttons */
.rate-btn-1 {
    background: #dbeafe;
    color: #1e40af;
    border: 1px solid #60a5fa;
}

/* Blue 100 */
.rate-btn-2 {
    background: #e0f2fe;
    color: #0369a1;
    border: 1px solid #38bdf8;
}

/* Sky 100 */
.rate-btn-3 {
    background: #ccfbf1;
    color: #0f766e;
    border: 1px solid #2dd4bf;
}

/* Teal 100 */
.rate-btn-4 {
    background: #dcfce7;
    color: #15803d;
    border: 1px solid #4ade80;
}

/* Green 100 */
.rate-btn-5 {
    background: #d1fae5;
    color: #065f46;
    border: 1px solid #34d399;
}

/* Emerald 100 */
.rate-btn-6 {
    background: #fef9c3;
    color: #854d0e;
    border: 1px solid #facc15;
}

/* Yellow 100 */

/* Dark Mode Adaptation: Keep them visible but maybe darker? 
   User asked "exactly like screenshot". Screenshot is Light Mode.
   If background is dark, these bright buttons will pop. That's fine.
   Maybe reduce opacity for dark mode slightly to avoid eye strain.
*/
@media (prefers-color-scheme: dark) {
    .rate-btn-1 {
        background: rgba(59, 130, 246, 0.2);
        color: #93c5fd;
        border-color: #3b82f6;
    }

    .rate-btn-2 {
        background: rgba(14, 165, 233, 0.2);
        color: #7dd3fc;
        border-color: #0ea5e9;
    }

    .rate-btn-3 {
        background: rgba(20, 184, 166, 0.2);
        color: #5eead4;
        border-color: #14b8a6;
    }

    .rate-btn-4 {
        background: rgba(34, 197, 94, 0.2);
        color: #86efac;
        border-color: #22c55e;
    }

    .rate-btn-5 {
        background: rgba(var(--accent-2-rgb, 16, 185, 129), 0.2);
        color: var(--accent-bright);
        border-color: var(--accent-2);
    }

    .rate-btn-6 {
        background: rgba(234, 179, 8, 0.2);
        color: #fde047;
        border-color: #eab308;
    }
}

.session-progress-container {
    width: 100%;
    padding: 0 0.5rem;
}

.progress-track-thin {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
}

.progress-fill-thin {
    height: 100%;
    background: var(--text-muted);
    border-radius: 3px;
    width: 0%;
}

/* --- NEW SETTINGS DROPDOWN & TOGGLES --- */

/* Full-page Settings Overlay */
.session-settings-glass-overlay {
    position: absolute;
    inset: 0;
    z-index: 1000;
    /* Over everything in the session */
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(10, 15, 25, 0.7);
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    animation: fadeInOverlay 0.3s ease;
}

.settings-content {
    width: 90%;
    max-width: 380px;
    padding: 2rem;
    animation: slideUpSettings 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.2rem 0;
    color: #ffffff;
    font-size: 1.05rem;
}

@keyframes fadeInOverlay {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes slideUpSettings {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Settings Dropdown (Old behavior, maybe unused now, but keeping glass effect) */
.glass-dropdown {
    background: rgba(30, 41, 59, 0.8);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.7);
    padding: 0.5rem 0;
    overflow: hidden;
}

.dropdown-item-row {
    padding: 0.8rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--text-main);
    font-size: 0.95rem;
}

/* Toggle Switch - Fast & Vibrant Liquid Style */
.toggle-switch-btn {
    width: 44px;
    height: 24px;
    background: rgba(255, 255, 255, 0.12);
    border-radius: 24px;
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.08);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    outline: none;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.toggle-switch-btn.active {
    background: #10b981;
    /* High-vibrancy Emerald */
    border-color: #10b981;
    box-shadow: none;
}

.toggle-thumb {
    width: 18px;
    height: 18px;
    background: #ffffff;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.toggle-switch-btn.active .toggle-thumb {
    transform: translateX(22px);
    background: #ffffff;
    box-shadow: none;
}

.toggle-switch-btn:active .toggle-thumb {
    width: 24px;
    border-radius: 12px;
}

/* Liquid Section Expansion */
.settings-expand-section {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 0.8s cubic-bezier(0.16, 1, 0.3, 1),
        opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1),
        transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
    transform: translateY(-15px) scale(0.97);
    filter: blur(5px);
    pointer-events: none;
}

.settings-expand-section.expanded {
    max-height: 1000px;
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: blur(0);
    pointer-events: auto;
    margin-bottom: 1rem;
}

@keyframes liquidGlassOpen {
    from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
        backdrop-filter: blur(0px);
    }

    to {
        opacity: 1;
        transform: scale(1) translateY(0);
        backdrop-filter: blur(24px);
    }
}